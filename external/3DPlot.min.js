function registerNameSpace(a){for(var b=a.split("."),c=window,d=b.length,e=0;d>e;e++)"undefined"==typeof c[b[e]]&&(c[b[e]]=new Object),c=c[b[e]]}function distance(a,b){return Math.sqrt((a.x-b.x)*(a.x-b.x)+(a.y-b.y)*(a.y-b.y))}registerNameSpace("greg.ross.visualisation"),greg.ross.visualisation.SurfacePlot=function(a){this.containerElement=a},greg.ross.visualisation.SurfacePlot.prototype.draw=function(a,b){var c=b.xPos,d=b.yPos,e=b.width,f=b.height,g=b.colourGradient,h=b.fillPolygons,i=b.tooltips,j=b.xTitle,k=b.yTitle,l=b.zTitle,m=b.restrictXRotation;void 0==this.surfacePlot&&(this.surfacePlot=new greg.ross.visualisation.JSSurfacePlot(c,d,e,f,g,this.containerElement,h,i,j,k,l,m)),this.surfacePlot.redraw(a)},greg.ross.visualisation.JSSurfacePlot=function(a,b,c,d,e,f,g,h,j,k,l,m){function U(){z=new greg.ross.visualisation.Th3dtran,db(),targetDiv&&gb()}function V(){T.hide()}function W(a){new greg.ross.visualisation.Point(a.x,a.y),T.show(h[M],200)}function X(a){p.clearRect(0,0,o.width,o.height),p.fillStyle="#000",p.fillRect(0,0,o.width,o.height),this.data=a;var b=c,f=20,h=b-2*f,j=f,k=f;if(z.init(),z.translate(0,0,greg.ross.visualisation.JSSurfacePlot.DEFAULT_Z_OFFSET),z.rotate(s,0,r),z.scale(q),z.translate(h/2+j,h/2+k,0),A=new greg.ross.visualisation.Point3D(h/2+j,h/2+k,-1e3),C)for(i=0;i<v.length;i++){var l=v[i];p.fillStyle="#ff2222";var m=z.ChangeObjectPoint(l);m.dist=distance(m,A);var n=m.ax,t=m.ay;p.beginPath();var u=greg.ross.visualisation.JSSurfacePlot.DATA_DOT_SIZE;p.arc(n-u/2,t-u/2,1,0,2*self.Math.PI,!0),p.fill()}var w=_(),x=ab(v);for(i=0;i<w.length;i++)x[x.length]=w[i];for(x.sort(greg.ross.visualisation.PolygonComaparator),p.lineWidth=1,p.strokeStyle="#888",p.lineJoin="round",i=0;i<x.length;i++){var y=x[i];if(y.isAnAxis()){var D=y.getPoint(0),E=y.getPoint(1);p.beginPath(),p.moveTo(D.ax,D.ay),p.lineTo(E.ax,E.ay),p.stroke()}else{var D=y.getPoint(0),E=y.getPoint(1),F=y.getPoint(2),G=y.getPoint(3),H=(1*D.lz+1*E.lz+1*F.lz+1*G.lz)/4;0>H&&(H*=-1);var I=B.getColour(H),J="rgb("+I.red+","+I.green+","+I.blue+")";p.fillStyle=J,p.beginPath(),p.moveTo(D.ax,D.ay),p.lineTo(E.ax,E.ay),p.lineTo(F.ax,F.ay),p.lineTo(G.ax,G.ay),p.lineTo(D.ax,D.ay),g?p.fill():p.stroke()}}p.stroke(),fb()&&Y(w)}function Y(a){var b=new greg.ross.visualisation.Point3D(0,.5,0),c=new greg.ross.visualisation.Point3D(-.5,0,0),d=new greg.ross.visualisation.Point3D(-.5,.5,.5),e=z.ChangeObjectPoint(b),f=z.ChangeObjectPoint(c),g=z.ChangeObjectPoint(d),h=a[0],i=a[1],m=a[2];if(p.fillStyle="#fff",h.distanceFromCamera>i.distanceFromCamera){var n=e.ax,o=e.ay;p.fillText(j,n,o)}if(h.distanceFromCamera<i.distanceFromCamera){var q=f.ax,r=f.ay;p.fillText(k,q,r)}if(h.distanceFromCamera<m.distanceFromCamera){var s=g.ax,t=g.ay;p.fillText(l,s,t)}}function _(){var a=new greg.ross.visualisation.Point3D(-.5,.5,0),b=new greg.ross.visualisation.Point3D(.5,.5,0),c=new greg.ross.visualisation.Point3D(-.5,-.5,0),d=new greg.ross.visualisation.Point3D(-.5,.5,1),e=z.ChangeObjectPoint(a),f=z.ChangeObjectPoint(b),g=z.ChangeObjectPoint(c),h=z.ChangeObjectPoint(d),i=new Array,j=new greg.ross.visualisation.Polygon(A,!0);j.addPoint(e),j.addPoint(f),j.calculateCentroid(),j.calculateDistance(),i[i.length]=j;var k=new greg.ross.visualisation.Polygon(A,!0);k.addPoint(e),k.addPoint(g),k.calculateCentroid(),k.calculateDistance(),i[i.length]=k;var l=new greg.ross.visualisation.Polygon(A,!0);return l.addPoint(e),l.addPoint(h),l.calculateCentroid(),l.calculateDistance(),i[i.length]=l,i}function ab(a){var b,c,d=new Array,e=0;for(b=0;x-1>b;b++)for(c=0;y-1>c;c++){var f=new greg.ross.visualisation.Polygon(A,!1),g=z.ChangeObjectPoint(a[c+b*y]),h=z.ChangeObjectPoint(a[c+b*y+y]),i=z.ChangeObjectPoint(a[c+b*y+y+1]),j=z.ChangeObjectPoint(a[c+b*y+1]);f.addPoint(g),f.addPoint(h),f.addPoint(i),f.addPoint(j),f.calculateCentroid(),f.calculateDistance(),d[e]=f,e++}return d}function bb(){var a={red:0,green:0,blue:255},b={red:0,green:255,blue:255},c={red:0,green:255,blue:0},d={red:255,green:255,blue:0},e={red:255,green:0,blue:0};return[a,b,c,d,e]}function cb(){var a=0,b="surfacePlot";do a++;while(document.getElementById(b+a));return b+a}function db(){this.targetDiv=document.createElement("div"),this.targetDiv.id=n,this.targetDiv.className="surfaceplot",this.targetDiv.style.background="#ffffff",this.targetDiv.style.position="absolute",f?(this.targetDiv.style.position="relative",f.appendChild(this.targetDiv)):document.body.appendChild(this.targetDiv),this.targetDiv.style.left=a+"px",this.targetDiv.style.top=b+"px"}function eb(){var a=-1;if("Microsoft Internet Explorer"==navigator.appName){var b=navigator.userAgent,c=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");null!=c.exec(b)&&(a=parseFloat(RegExp.$1))}return a}function fb(){return t?u:(t=!0,u=!!document.createElement("canvas").getContext)}function gb(){o=document.createElement("canvas"),fb()||(G_vmlCanvasManager.initElement(o),o.style.width=c,o.style.height=d),o.className="surfacePlotCanvas",o.setAttribute("width",c),o.setAttribute("height",d),o.style.left="0px",o.style.top="0px",targetDiv.appendChild(o),p=o.getContext("2d"),p.font="bold 18px sans-serif",p.clearRect(0,0,o.width,o.height),p.fillStyle="#000",p.fillRect(0,0,o.width,o.height),p.beginPath(),p.rect(0,0,o.width,o.height),p.strokeStyle="#888",p.stroke(),o.onmousemove=jb,o.onmouseout=V,o.onmousedown=hb,o.onmouseup=ib,o.addEventListener("touchstart",hb,!1),o.addEventListener("touchmove",jb,!1),o.addEventListener("touchend",ib,!1),o.addEventListener("touchcancel",V,!1)}function hb(a){kb(a)?(E=!0,L=lb(a)):(D=!0,K=lb(a))}function ib(){D?I=H:E&&(J=H),D=!1,E=!1}function jb(a){var b=lb(a);if(D)V(),mb(b);else if(E)V(),nb(b);else{M=null;for(var c=Number.MAX_VALUE,d=0;d<v.length;d++){var e=v[d],f=distance({x:e.ax,y:e.ay},b);c>f&&(c=f,M=d)}if(c>16)return V(),void 0;W(b)}return!1}function kb(a){var b=0;if(parseInt(navigator.appVersion)>3){var c="Netscape"==navigator.appName?a:event;if("Netscape"==navigator.appName&&4==parseInt(navigator.appVersion)){var d=(a.modifiers+32).toString(2).substring(3,6);b="1"==d.charAt(0)}else b=c.shiftKey;if(b)return!0}return!1}function lb(a){if(eb()>-1){var a=window.event;if(1==a.srcElement.getAttribute("Stroked")){if(null==F||null==G)return}else F=a.offsetX,G=a.offsetY}else a.layerX||0==a.layerX?(F=a.layerX,G=a.layerY):a.offsetX||0==a.offsetX?(F=a.offsetX,G=a.offsetY):(a.touches[0].pageX||0==a.touches[0].pageX)&&(F=a.touches[0].pageX,G=a.touches[0].pageY);var b=new greg.ross.visualisation.Point(F,G);return b}function mb(a){H=new greg.ross.visualisation.Point(greg.ross.visualisation.JSSurfacePlot.DEFAULT_Z_ANGLE,greg.ross.visualisation.JSSurfacePlot.DEFAULT_X_ANGLE),null==I&&(I=new greg.ross.visualisation.Point(greg.ross.visualisation.JSSurfacePlot.DEFAULT_Z_ANGLE,greg.ross.visualisation.JSSurfacePlot.DEFAULT_X_ANGLE)),null!=K&&(H=new greg.ross.visualisation.Point(I.x+(K.x-a.x),I.y+(K.y-a.y))),r=H.x%360,s=H.y%360,m&&(0>s?s=0:s>90&&(s=90)),M=null,X(data)}function nb(a){H=new greg.ross.visualisation.Point(0,greg.ross.visualisation.JSSurfacePlot.DEFAULT_SCALE/greg.ross.visualisation.JSSurfacePlot.SCALE_FACTOR),null==J&&(J=new greg.ross.visualisation.Point(0,greg.ross.visualisation.JSSurfacePlot.DEFAULT_SCALE/greg.ross.visualisation.JSSurfacePlot.SCALE_FACTOR)),null!=L&&(H=new greg.ross.visualisation.Point(J.x+(L.x-a.x),J.y+(L.y-a.y))),q=H.y*greg.ross.visualisation.JSSurfacePlot.SCALE_FACTOR,q<greg.ross.visualisation.JSSurfacePlot.MIN_SCALE?q=greg.ross.visualisation.JSSurfacePlot.MIN_SCALE+1:q>greg.ross.visualisation.JSSurfacePlot.MAX_SCALE&&(q=greg.ross.visualisation.JSSurfacePlot.MAX_SCALE-1),H.y=q/greg.ross.visualisation.JSSurfacePlot.SCALE_FACTOR,M=null,X(data)}this.targetDiv;var o,n=cb(),p=null,q=greg.ross.visualisation.JSSurfacePlot.DEFAULT_SCALE,r=greg.ross.visualisation.JSSurfacePlot.DEFAULT_Z_ANGLE,s=greg.ross.visualisation.JSSurfacePlot.DEFAULT_X_ANGLE;this.data=null;var x,y,z,A,e,B,t=!1,u=!0,v=null,C=!1,D=!1,E=!1,F=null,G=null,H=new greg.ross.visualisation.Point(0,0),I=null,J=null,K=new greg.ross.visualisation.Point(0,0),L=new greg.ross.visualisation.Point(0,0),M=null;new greg.ross.visualisation.Tooltip(!0),new greg.ross.visualisation.Tooltip(!0),new greg.ross.visualisation.Tooltip(!0);var T=new greg.ross.visualisation.Tooltip(!1);this.redraw=function(a){x=1*a.getNumberOfRows(),y=1*a.getNumberOfColumns();for(var b=Number.MAX_VALUE,f=Number.MIN_VALUE,g=0;x>g;g++)for(var h=0;y>h;h++){var i=a.getFormattedValue(g,h);b>i&&(b=i),i>f&&(f=i)}var j;j=e?e:bb(),B=new greg.ross.visualisation.ColourGradient(b,f,j);var k=c,l=d,m=20,n=k-2*m,o=m,p=m;k>l?(n=l-2*m,o=(k-n)/2):l>k&&(n=k-2*m,p=(l-n)/2);var s,t,g,h,q=1/(x-1),r=1/(y-1);v=new Array;var w=0;for(g=0,s=-.5;x>g;g++,s+=q)for(h=0,t=.5;y>h;h++,t-=r){var z=s,A=t;v[w]=new greg.ross.visualisation.Point3D(z,A,a.getFormattedValue(g,h)),w++}X(a)},U()},greg.ross.visualisation.Matrix3d=function(){this.matrix=new Array,this.numRows=4,this.numCols=4,this.init=function(){this.matrix=new Array;for(var a=0;a<this.numRows;a++)this.matrix[a]=new Array},this.getMatrix=function(){return this.matrix},this.matrixReset=function(){for(var a=0;a<this.numRows;a++)for(var b=0;b<this.numCols;b++)this.matrix[a][b]=0},this.matrixIdentity=function(){this.matrixReset(),this.matrix[0][0]=this.matrix[1][1]=this.matrix[2][2]=this.matrix[3][3]=1},this.matrixCopy=function(a){var c,d,b=new greg.ross.visualisation.Matrix3d;for(c=0;c<this.numRows;c++)for(d=0;d<this.numCols;d++)b.getMatrix()[c][d]=this.matrix[c][0]*a.getMatrix()[0][d]+this.matrix[c][1]*a.getMatrix()[1][d]+this.matrix[c][2]*a.getMatrix()[2][d]+this.matrix[c][3]*a.getMatrix()[3][d];for(c=0;c<this.numRows;c++)this.matrix[c][0]=b.getMatrix()[c][0],this.matrix[c][1]=b.getMatrix()[c][1],this.matrix[c][2]=b.getMatrix()[c][2],this.matrix[c][3]=b.getMatrix()[c][3]},this.matrixMult=function(a,b){var d,e,c=new greg.ross.visualisation.Matrix3d;for(d=0;d<this.numRows;d++)for(e=0;e<this.numCols;e++)c.getMatrix()[d][e]=b.getMatrix()[d][0]*a.getMatrix()[0][e]+b.getMatrix()[d][1]*a.getMatrix()[1][e]+b.getMatrix()[d][2]*a.getMatrix()[2][e]+b.getMatrix()[d][3]*a.getMatrix()[3][e];for(d=0;d<this.numRows;d++)a.getMatrix()[d][0]=c.getMatrix()[d][0],a.getMatrix()[d][1]=c.getMatrix()[d][1],a.getMatrix()[d][2]=c.getMatrix()[d][2],a.getMatrix()[d][3]=c.getMatrix()[d][3]},this.init()},greg.ross.visualisation.Point3D=function(a,b,c){this.displayValue="",this.lx,this.ly,this.lz,this.lt,this.wx,this.wy,this.wz,this.wt,this.ax,this.ay,this.az,this.at,this.dist,this.initPoint=function(){this.lx=this.ly=this.lz=this.ax=this.ay=this.az=this.at=this.wx=this.wy=this.wz=0,this.lt=this.wt=1},this.init=function(a,b,c){this.initPoint(),this.lx=a,this.ly=b,this.lz=c,this.ax=this.lx,this.ay=this.ly,this.az=this.lz},this.init(a,b,c)},greg.ross.visualisation.Polygon=function(a,b){this.points=new Array,this.cameraPosition=a,this.isAxis=b,this.centroid=null,this.distanceFromCamera=null,this.isAnAxis=function(){return this.isAxis},this.addPoint=function(a){this.points[this.points.length]=a},this.distance=function(){return this.distance2(this.cameraPosition,this.centroid)},this.calculateDistance=function(){this.distanceFromCamera=this.distance()},this.calculateCentroid=function(){for(var a=0,b=0,c=0,d=1*this.points.length,e=0;d>e;e++)a+=this.points[e].ax,b+=this.points[e].ay,c+=this.points[e].az;a/=d,b/=d,c/=d,this.centroid=new greg.ross.visualisation.Point3D(a,b,c)},this.distance2=function(a,b){return(a.ax-b.ax)*(a.ax-b.ax)+(a.ay-b.ay)*(a.ay-b.ay)+(a.az-b.az)*(a.az-b.az)},this.getPoint=function(a){return this.points[a]}},greg.ross.visualisation.PolygonComaparator=function(a,b){var c=a.distanceFromCamera-b.distanceFromCamera;return 0==c?0:0>c?-1:c>0?1:0},greg.ross.visualisation.Th3dtran=function(){this.matrix,this.rMat,this.rMatrix,this.objectMatrix,this.local=!0,this.init=function(){this.matrix=new greg.ross.visualisation.Matrix3d,this.rMat=new greg.ross.visualisation.Matrix3d,this.rMatrix=new greg.ross.visualisation.Matrix3d,this.objectMatrix=new greg.ross.visualisation.Matrix3d,this.initMatrix()},this.initMatrix=function(){this.matrix.matrixIdentity(),this.objectMatrix.matrixIdentity()},this.translate=function(a,b,c){this.rMat.matrixIdentity(),this.rMat.getMatrix()[3][0]=a,this.rMat.getMatrix()[3][1]=b,this.rMat.getMatrix()[3][2]=c,this.local?this.objectMatrix.matrixCopy(this.rMat):this.matrix.matrixCopy(this.rMat)},this.rotate=function(a,b,c){var d=a*(Math.PI/180),e=b*(Math.PI/180),f=c*(Math.PI/180);this.rMatrix.matrixIdentity(),this.rMat.matrixIdentity(),this.rMat.getMatrix()[1][1]=Math.cos(d),this.rMat.getMatrix()[1][2]=Math.sin(d),this.rMat.getMatrix()[2][1]=-Math.sin(d),this.rMat.getMatrix()[2][2]=Math.cos(d),this.rMatrix.matrixMult(this.rMatrix,this.rMat),this.rMat.matrixIdentity(),this.rMat.getMatrix()[0][0]=Math.cos(e),this.rMat.getMatrix()[0][2]=-Math.sin(e),this.rMat.getMatrix()[2][0]=Math.sin(e),this.rMat.getMatrix()[2][2]=Math.cos(e),this.rMat.matrixMult(this.rMatrix,this.rMat),this.rMat.matrixIdentity(),this.rMat.getMatrix()[0][0]=Math.cos(f),this.rMat.getMatrix()[0][1]=Math.sin(f),this.rMat.getMatrix()[1][0]=-Math.sin(f),this.rMat.getMatrix()[1][1]=Math.cos(f),this.rMat.matrixMult(this.rMatrix,this.rMat),this.local?this.objectMatrix.matrixCopy(this.rMatrix):this.matrix.matrixCopy(this.rMatrix)},this.scale=function(a){this.rMat.matrixIdentity(),this.rMat.getMatrix()[0][0]=a,this.rMat.getMatrix()[1][1]=a,this.rMat.getMatrix()[2][2]=a,this.local?this.objectMatrix.matrixCopy(this.rMat):this.matrix.matrixCopy(this.rMat)},this.changeLocalObject=function(a){return a.wx=a.ax*this.matrix.getMatrix()[0][0]+a.ay*this.matrix.getMatrix()[1][0]+a.az*this.matrix.getMatrix()[2][0]+this.matrix.getMatrix()[3][0],a.wy=a.ax*this.matrix.getMatrix()[0][1]+a.ay*this.matrix.getMatrix()[1][1]+a.az*this.matrix.getMatrix()[2][1]+this.matrix.getMatrix()[3][1],a.wz=a.ax*this.matrix.getMatrix()[0][2]+a.ay*this.matrix.getMatrix()[1][2]+a.az*this.matrix.getMatrix()[2][2]+this.matrix.getMatrix()[3][2],a},this.ChangeObjectPoint=function(a){return a.ax=a.lx*this.objectMatrix.getMatrix()[0][0]+a.ly*this.objectMatrix.getMatrix()[1][0]+a.lz*this.objectMatrix.getMatrix()[2][0]+this.objectMatrix.getMatrix()[3][0],a.ay=a.lx*this.objectMatrix.getMatrix()[0][1]+a.ly*this.objectMatrix.getMatrix()[1][1]+a.lz*this.objectMatrix.getMatrix()[2][1]+this.objectMatrix.getMatrix()[3][1],a.az=a.lx*this.objectMatrix.getMatrix()[0][2]+a.ly*this.objectMatrix.getMatrix()[1][2]+a.lz*this.objectMatrix.getMatrix()[2][2]+this.objectMatrix.getMatrix()[3][2],a},this.init()},greg.ross.visualisation.Point=function(a,b){this.x=a,this.y=b},greg.ross.visualisation.Tooltip=function(a){function o(a){var b=h;if(b!=g&&1==a||0!=b&&-1==a){var c=e;e>g-b&&1==a?c=g-b:e>h&&-1==a&&(c=b),h=b+c*a,i.style.opacity=.01*h,i.style.filter="alpha(opacity="+h+")"}else clearInterval(i.timer),-1==a&&(i.style.display="none")}var i,j,k,l,m,b=3,c=3,d=300,e=10,f=20,g=95,h=0,n=document.all?!0:!1;this.show=function(c,e){null==i&&(i=document.createElement("div"),i.style.color="#fff",i.style.position="absolute",i.style.display="block",j=document.createElement("div"),j.style.display="block",j.style.height="5px",j.style.marginleft="5px",j.style.overflow="hidden",k=document.createElement("div"),l=document.createElement("div"),i.appendChild(j),i.appendChild(k),i.appendChild(l),document.body.appendChild(i),n?i.style.opacity=1:(i.style.opacity=0,i.style.filter="alpha(opacity=0)")),a||(document.onmousemove=this.pos),i.style.display="block",k.innerHTML='<span style="font-weight:bold; font-family: arial;">'+c+"</span>",i.style.width=e?e+"px":"auto",!e&&n&&(j.style.display="none",l.style.display="none",i.style.width=i.offsetWidth,j.style.display="block",l.style.display="block"),i.offsetWidth>d&&(i.style.width=d+"px"),m=parseInt(i.offsetHeight)+b,n||(clearInterval(i.timer),i.timer=setInterval(function(){o(1)},f))},this.setPos=function(a){i.style.top=a.y+"px",i.style.left=a.x+"px"},this.pos=function(a){var b=n?event.clientY+document.documentElement.scrollTop:a.pageY,d=n?event.clientX+document.documentElement.scrollLeft:a.pageX;i.style.top=b-m+"px",i.style.left=d+c+"px"},this.hide=function(){null!=i&&(n?i.style.display="none":(clearInterval(i.timer),i.timer=setInterval(function(){o(-1)},f)))}},greg.ross.visualisation.JSSurfacePlot.DEFAULT_X_ANGLE=47,greg.ross.visualisation.JSSurfacePlot.DEFAULT_Z_ANGLE=47,greg.ross.visualisation.JSSurfacePlot.DATA_DOT_SIZE=3,greg.ross.visualisation.JSSurfacePlot.DEFAULT_Z_OFFSET=-.1,greg.ross.visualisation.JSSurfacePlot.DEFAULT_SCALE=350,greg.ross.visualisation.JSSurfacePlot.MIN_SCALE=50,greg.ross.visualisation.JSSurfacePlot.MAX_SCALE=1100,greg.ross.visualisation.JSSurfacePlot.SCALE_FACTOR=1.4,greg.ross.visualisation.ColourGradient=function(a,b,c){function d(a){var b=c.length,d=1/(b-1),g=a/d,g=parseInt(g+"");g=g==b-1?g-1:g;var h=c[g],i=c[g+1];if(void 0==h||void 0==i)return c[0];var j,k;e(h)>e(i)?(j=i,k=h):(j=h,k=i);var l;l=j==i?1-f(a,g*d,(g+1)*d):f(a,g*d,(g+1)*d);var m=[l*(k.red-j.red),l*(k.green-j.green),l*(k.blue-j.blue)],n=j.red+m[0],o=j.green+m[1],p=j.blue+m[2];n=parseInt(n),o=parseInt(o),p=parseInt(p);var q={red:n,green:o,blue:p};return q}function e(a){return a.red*a.red+a.green*a.green+a.blue*a.blue}function f(a,b,c){if(b==c)return 0;var d=(a-b)/(c-b);return d}this.getColour=function(e){if(isNaN(e))return c[0];if(a>e||1==c.length)return c[0];if(a>e||e>b||1==c.length)return c[c.length-1];var g=f(e,a,b);return d(g)}};